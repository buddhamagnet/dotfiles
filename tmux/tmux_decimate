ps -A | grep mt | xargs kill

tmux has-session -t decimate
if [ $? != 0 ]
then
  tmux new-session -s decimate -n DEV -d
  tmux new-window -n GRAPHQL -t decimate
  tmux send-keys -t decimate:1 'cd /Users/buddhamagnet/golang/src/github.com/EconomistDigitalSolutions/mt-content-graphql-canonical' C-m
   tmux send-keys -t decimate:1 'source .env' C-m
  tmux send-keys -t decimate:1 'npm install && npm run serve' C-m
  tmux new-window -n S3_PROXY -t decimate
  tmux send-keys -t decimate:2 'cd /Users/buddhamagnet/golang/src/github.com/EconomistDigitalSolutions/cp-scripts/proxyS3' C-m
  tmux send-keys -t decimate:2 'go run proxyS3.go' C-m
  tmux new-window -n GATEWAY -t decimate
  tmux send-keys -t decimate:3 'cd /Users/buddhamagnet/golang/src/github.com/EconomistDigitalSolutions/mt-content-gateway' C-m
  tmux send-keys -t decimate:3 'unset DOCKER_HOST' C-m
  tmux send-keys -t decimate:3 'docker kill $(docker ps -q --filter ancestor=680545668187.dkr.ecr.us-east-1.amazonaws.com/sandwitch:latest)' C-m
  tmux send-keys -t decimate:3 './build.sh run' C-m
  tmux new-window -n SEARCH -t decimate
  tmux send-keys -t decimate:4 'elasticsearch' C-m
  tmux new-window -n SEARCH_CONFIG -t decimate
  tmux send-keys -t decimate:5 'cd /usr/local/Cellar/elasticsearch/5.6.1/libexec/config' C-m
  tmux new-window -n FE -t decimate
  tmux send-keys -t decimate:6 'cd /Users/buddhamagnet/golang/src/github.com/EconomistDigitalSolutions/fe-blogs' C-m
  tmux send-keys -t decimate:6 'export API_GATEWAY_ENDPOINT=http://localhost:3001' C-m
  tmux send-keys -t decimate:6 'npm install && npm start' C-m
  tmux new-window -n DECIMATE -t decimate
  tmux send-keys -t decimate:7 'cd' C-m
  tmux send-keys -t decimate:7 'open http://localhost:8080/content/d65luhl1jc8au03dch2vom7g21h40h3h?payload=canonical-full && open http://localhost:3001/graphiql && open http://localhost:9200/v1/canonical/_search' C-m
  tmux select-window -t decimate:1
fi
tmux attach -t decimate
